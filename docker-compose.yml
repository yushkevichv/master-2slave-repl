version: '3'
services:
  mysql_master:
    image: 'mysql:5.7'
    ports:
      - '3306'
    container_name: 'mysql_master'
    volumes:
      - ./master/conf/mysql.conf.cnf:/etc/mysql/conf.d/mysql.conf.cnf
      - ./master/data:/var/lib/mysql
    environment:
      - MYSQL_DATABASE=test_repl_db
      - MYSQL_ROOT_PASSWORD=pwd
      - MYSQL_USER=user
      - MYSQL_PASSWORD=pwd

  mysql_slave:
    image: mysql:5.7
    container_name: 'mysql_slave'
    environment:
      - MYSQL_DATABASE=test_repl_db
      - MYSQL_ROOT_PASSWORD=pwd
      - MYSQL_USER=slave_user
      - MYSQL_PASSWORD=slave_pwd
    volumes:
      - ./slave/conf/mysql.conf.cnf:/etc/mysql/conf.d/mysql.conf.cnf
      - ./slave/data:/var/lib/mysql
    ports:
      - '3306'
    depends_on:
      - mysql_master

  mysql_slave2:
    image: mysql:5.7
    container_name: 'mysql_slave2'
    environment:
      - MYSQL_DATABASE=test_repl_db
      - MYSQL_ROOT_PASSWORD=pwd
      - MYSQL_USER=slave_user
      - MYSQL_PASSWORD=slave_pwd
    volumes:
      - ./slave2/conf/mysql.conf.cnf:/etc/mysql/conf.d/mysql.conf.cnf
      - ./slave2/data:/var/lib/mysql
    ports:
      - '3306'
    depends_on:
      - mysql_master
